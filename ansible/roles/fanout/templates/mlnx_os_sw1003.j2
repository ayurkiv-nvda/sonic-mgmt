{% set eth_ports = ['ERR', '1/1', '1/2', '1/3', '1/4', '1/5', '1/6', '1/7', '1/8', '1/9', '1/10', '1/11', '1/12', '1/13', '1/14', '1/15', '1/16', '1/17', '1/18', '1/19', '1/20', '1/21', '1/22', '1/23', '1/24', '1/25', '1/26', '1/27', '1/28', '1/29', '1/30', '1/31/1', '1/31/2', '1/32'] %}
{% set uplink_port_id = 33 %}
{% set of_ports = [-1, 125, 127, 121, 123, 117, 119, 113, 115, 109, 111, 105, 107, 101, 103, 97, 99, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 94, 95] -%}

config t

no lldp 
no spanning-tree 
ip routing
license install LK2-RESTRICTED_CMDS_GEN2-43A7-43LN-YFN5-488A-2AKD-6QCD-96

no fae trap-group TRAP_GROUP_LLDP policer bind
no fae trap-group TRAP_GROUP_OF_CONTROLLER policer bind
interface ethernet 1/31 module-type qsfp-split-2 force

{% for i in range(1, eth_ports|length - 5) %}
interface ethernet {{ eth_ports[i] }} speed 10000 force
{% endfor %}
interface ethernet 1/29 speed 50000 force
interface ethernet 1/30 speed 50000 force

{% for i in range(1, eth_ports|length) %}
interface ethernet {{ eth_ports[i] }} shutdown
interface ethernet {{ eth_ports[i] }} mtu 9216
interface ethernet {{ eth_ports[i] }} no shutdown
{% endfor %}

interface ethernet 1/32 switchport mode trunk

vlan 101-132
ex

interface ethernet 1/32 switchport trunk allowed-vlan none

{% for i in range(1,eth_ports|length-1) %}
{% set vlanid = (100+i)|string %}
interface ethernet {{eth_ports[i]}} switchport access vlan {{ vlanid }}
{% endfor %}

interface ethernet 1/32 switchport trunk allowed-vlan add 101-132
interface ethernet 1/32 switchport trunk allowed-vlan remove 1

protocol openflow

{% for i in range(1, eth_ports|length) %}
interface ethernet {{ eth_ports[i] }} openflow mode hybrid
{% endfor %}

{% set of_counter = 0 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (100+i)|string %}
openflow add-flows {{ of_counter + i }} table=0,priority=100,dl_type=0x88CC,in_port={{ of_ports[uplink_port_id] }},dl_vlan={{ vlanid }},actions=output:{{ of_ports[i] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (100+i)|string %}
openflow add-flows {{ of_counter + i }} table=0,priority=101,dl_type=0x88CC,in_port={{ of_ports[i] }},actions=mod_vlan_vid:{{ vlanid }},output:{{ of_ports[uplink_port_id] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (100+i)|string %}
openflow add-flows {{ of_counter + i }} table=0,priority=100,dl_type=0x8809,in_port={{ of_ports[uplink_port_id] }},dl_vlan={{ vlanid }},actions=output:{{ of_ports[i] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (100+i)|string %}
openflow add-flows {{ of_counter + i }} table=0,priority=101,dl_type=0x8809,in_port={{ of_ports[i] }},actions=mod_vlan_vid:{{ vlanid }},output:{{ of_ports[uplink_port_id] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (100+i)|string %}
openflow add-flows {{ of_counter + i }} table=0,priority=100,in_port={{ of_ports[uplink_port_id] }},dl_vlan={{ vlanid }},actions=output:{{ of_ports[i] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (100+i)|string %}
openflow add-flows {{ of_counter + i }} table=0,priority=101,dl_type=0x0806,in_port={{ of_ports[i] }},actions=mod_vlan_vid:{{ vlanid }},output:{{ of_ports[uplink_port_id] }}
{% endfor %}

docker 
no shutdown
exit

write memory

