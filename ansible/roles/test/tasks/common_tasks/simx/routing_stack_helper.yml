
- name: "Get system routing stack"
  shell: "docker ps | grep bgp | awk '{print$2}' | cut -d'-' -f3 | cut -d':' -f1"
  register: bgp_type

- name: "Get BGP config mode from config_db"
  command: "sonic-cfggen -d -v 'DEVICE_METADATA[\"localhost\"][\"docker_routing_config_mode\"]'"
  register: config_mode

# For Quagga
- name: "Set BGP template config facts"
  set_fact:
    bgp_orig_config: "/usr/share/sonic/templates/zebra.conf.j2_orig"
    bgp_simx_config: "/usr/share/sonic/templates/zebra.conf.j2_simx"
    bgp_config: "/usr/share/sonic/templates/zebra.conf.j2"
  when: "bgp_type.stdout == 'quagga'"

# For FRR
- block:

  - name: "Set BGP template config facts: unified mode"
    set_fact:
      bgp_orig_config: "/usr/share/sonic/templates/frr.conf.j2_orig"
      bgp_simx_config: "/usr/share/sonic/templates/frr.conf.j2_simx"
      bgp_config: "/usr/share/sonic/templates/frr.conf.j2"
    when: "config_mode.stdout == 'unified'"

  - name: "Set BGP template config facts: separated mode"
    set_fact:
      bgp_orig_config: "/usr/share/sonic/templates/zebra.conf.j2_orig"
      bgp_simx_config: "/usr/share/sonic/templates/zebra.conf.j2_simx"
      bgp_config: "/usr/share/sonic/templates/zebra.conf.j2"
    when: "config_mode.stdout == 'separated'"

  when: "bgp_type.stdout == 'frr'"
