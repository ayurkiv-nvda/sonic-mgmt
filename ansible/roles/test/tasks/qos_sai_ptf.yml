# This would be removed by ptf_runner.yml as soon as I get access to MLNX box to check

- name: Set parameters for specific test
  set_fact: ptf_base_params="{{ ptf_base_params + test_params }}"

# Temporary solution for Mellanox testbed
- name: ping "{{ ptf_host }}" from  "{{ ansible_host }}"
  shell: ping -c 20 {{ ansible_host }}
  delegate_to: "{{ ptf_host }}"

  
- name: "{{ test_name }}"
  shell: ptf --test-dir saitests {{ test_path }} --platform remote -t "{{ ptf_base_params|join(';') }}" --disable-ipv6 --disable-vxlan --disable-geneve --disable-erspan --disable-mpls --disable-nvgre {{ extra_options | default("")}} 2>&1
  args:
    chdir: /root
  delegate_to: "{{ ptf_host }}"
  failed_when: False
  register: out

- debug: var=out.stdout_lines
  when: out.rc != 0

- fail: msg="Failed test '{{ test_name }}'"
  when: out.rc != 0
