
- debug: var=item

- set_fact:
    green_min_limit: "{{ item['min'] | int * cell_size | int }}"
    green_max_limit: "{{ item['max'] | int * cell_size | int }}"
    ecn_tolerance: "{{ item['tolerance'] }}"

- set_fact:
    cmd: "ecnconfig -p AZURE_LOSSY -gmin {{ green_min_limit }} -gmax {{ green_max_limit }}"
    ecn_range_params:
    - green_min_limit='{{ green_min_limit }}'
    - green_max_limit='{{ green_max_limit }}'
    - ecn_tolerance='{{ ecn_tolerance }}'

- set_fact:
    test_params="{{ ecn_range_params + test_params_part }}"

- debug: var=test_params

- debug: var=cmd

- name: Set ECN config on switch
  include: roles/test/tasks/run_command_with_log_analyzer.yml
  vars:
    command_to_run: "{{ cmd }}"
    errors_expected: false
    testname: 'ECN_Range_Check'

- include: qos_sai_ptf_mlnx.yml
